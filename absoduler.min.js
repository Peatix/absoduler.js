!function(){function a(){var a;try{a=require("ws")}catch(b){}return a}function b(c){if("undefined"===c)throw"option is not given";if("undefined"===c.server&&"undefined"===c.socket)throw"option server or socket is required";if(this.pongs=[],this.maxPongs=8,this.initialized=!1,this.timerObject=c.timer?c.timer:"undefined"!=typeof window?window:"undefined"!=typeof global?global:null,!this.timerObject)throw"No timer found";if(this.WebSocket=c.WebSocket?c.WebSocket:"undefined"!=typeof WebSocket?WebSocket:a(),!this.WebSocket)throw"No WebSocket found";this.WebSocket.Sender&&(this.isNode=!0),this.serialize=b.Serialize.JSON,this.handlers={},this.timerStock={},c.server?this.connect(c):this.socket=this.Absodulerize(c.socket,c.fallback),this.startInitialize()}b.prototype.Absodulerize=function(a,b){return this.isNode?this._absodulerizeNode(a,b):this._absodulerizeBrowser(a,b)},b.prototype._absodulerizeNode=function(a){this.constructor.NodeAbsodulerize.call(this,a,this.serialize)},b.prototype._absodulerizeBrowser=function(a,b){var c=this;a.onmessage=function(a){var d=c.serialize.unpack(a);if(!d)throw"Unknown message";{if(!d.w)return c.handler(c.socket,d);if(b)return b(d.w)}},a._abdl_original_send=a.send,a.send=function(b){a._abdl_original_send(c.serialize.pack({w:b}))},a.send_abdl=function(b){return a._abdl_original_send(c.serialize.pack(b))}},b.prototype.handler=function(a,b){"pong"===b.t?this.onPong(b):this.scheduleDispatch(b)},b.prototype.connect=function(a){return this.isNode?this._connectNode(a):this._connectBrowser(a)},b.prototype._connectNode=function(a){var b=this;this.socket=new this.WebSocket(a.server),this.socket.on("open",function(){}),this.socket.on("error",function(a){b.initimer&&(b.timerObject.clearInterval(b.initimer),b.initimer=null),console.error("socket has closed by error: ",a)}),this.Absodulerize(this.socket,a.fallback)},b.prototype._connectBrowser=function(a){var b=this;this.socket=new this.WebSocket(a.server),this.socket.onopen=function(){},this.socket.onerror=function(){b.initimer&&(b.timerObject.clearInterval(b.initimer),b.initimer=null),console.error("socket has closed by error")},this.Absodulerize(this.socket,a.fallback)},b.prototype.ping=function(){var a=(new Date).getTime();this.socket.send_abdl({t:"ping",b:a})},b.prototype.onPong=function(a){var b=(new Date).getTime(),c=parseInt(a.b),d=parseInt(a.s),e=(b-c)/2,f=d-c+e,g={b:c,r:e,o:f};if(this.pongs.push(g),this.maxPongs<=this.pongs.length){for(;this.maxPongs<this.pongs.length;)this.pongs.shift();this.initialized||(this.initialized=!0,this.finishInitialize()),this.initialized&&this.calculateOffset()}},b.prototype.calculateOffset=function(){var a,b=36e5,c=this.pongs,d=c.length,e=0,f=0,g=0;for(a=0;d>a;a++)c[a].r<b&&(b=c[a].r);for(a=0;d>a;a++)f=b/c[a].r,e+=c[a].o*f,g+=f;this.offset=e/g},b.prototype.startInitialize=function(){var a=this;this.initimer=this.timerObject.setInterval(function(){if(0===a.socket.readyState)console.log("waiting...");else{if(1!==a.socket.readyState)throw a.timerObject.clearInterval(a.initimer),a.initimer=null,"socket has closed";a.timerObject.clearInterval(a.initimer),a.initimer=null,a._initialize()}},100)},b.prototype._initialize=function(){this.sendPings(this.maxPongs)},b.prototype.sendPings=function(a){for(var b=0,c=this,d=function(){c.ping()};a>b;b++)c.timerObject.setTimeout(d,50*b)},b.prototype.finishInitialize=function(){this.emit("initialized");var a=this;this.updatePingTimer=this.timerObject.setInterval(function(){a.sendPings(a.maxPings/2)},5e3)},b.prototype.scheduleDispatch=function(a){var b=0,c=this;if(a.a){var d=(new Date).getTime();b=parseInt(a.a)-d-this.offset}var e=this.timerObject.setTimeout(function(){c.dispatch(a)},b);this.timerStock[e]=1},b.prototype.dispatch=function(a){this.emit(a.t,a.d)},b.prototype.clearAllTimer=function(){for(var a in this.timerStock)this.timerObject.clearTimeout(a)},b.prototype.emit=function(a,b){var c=this.handlers[a];if("undefined"!=typeof c)for(var d in c)c[d].call(this,b)};var c={open:1,message:1,close:1};b.prototype.on=function(a,b){this.isNode&&c[a]&&this.socket.on(a,b);var d=this.handlers[a];"undefined"==typeof d&&(this.handlers[a]=d={}),d[b]=b},b.prototype.off=function(a,b){this.isNode&&c[a]&&this.socket.off(a,b);var d=this.handlers[a];"undefined"!=typeof d&&delete d[b]},b.prototype.close=function(){this.ws.close()},"undefined"!=typeof module&&(module.exports=b),"undefined"!=typeof window&&(window.Absoduler=b)}(),function(){var a={JSON:{unpack:function(a){var b;if("string"==typeof a)b=JSON.parse(a);else if("object"==typeof a&&a.data)b=JSON.parse(a.data);else{if("object"!=typeof a)throw console.log("Unrecognizable Message",typeof a,a),"unrecognizable message";b=a}return b},pack:function(a){return JSON.stringify(a)}}};"undefined"!=typeof module&&(module.exports=a),"undefined"!=typeof window&&(window.Absoduler.Serialize=a)}();